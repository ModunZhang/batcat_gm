{% extends '../../layouts/service.html' %}

{% block head %}
<script src='/javascripts/json-format.js'></script>
<link href="/stylesheets/json-format.css" rel="stylesheet">
{% endblock %}

{% block content %}
<ol class="breadcrumb">
    <li><a href="/service/alliance">Alliance</a></li>
    <li class="active">Search Alliance</li>
</ol>

<h4 style="text-align: center">Search Alliance</h4>

<form action="/service/alliance/find-by-id" method="get" role="form" class="form-horizontal" id="findById">
    <div class="form-group">
        <label for="game_1" class="col-sm-2 control-label">Game</label>

        <div class="col-sm-9">
            <select title='Choose a game' name="gameId" id="game_1" class="selectpicker">
                {% for game in req.games %}
                <option value="{{game._id}}">{{game.name}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="id" class="col-sm-2 control-label">By Id</label>

        <div class="col-sm-8">
            <input type="text" name="allianceId" placeholder="Id" id="id"
                   class="form-control">
        </div>
        <div class="col-sm-1">
            <button class="btn btn-primary" type="submit">Search</button>
        </div>
    </div>
</form>

<h5 style="text-align: center">Or</h5>

<form action="/service/alliance/find-by-tag" method="get" role="form" class="form-horizontal" id="findByTag">
    <div class="form-group">
        <label for="game_2" class="col-sm-2 control-label">Game</label>

        <div class="col-sm-9">
            <select title='Choose a game' name="gameId" id="game_2" class="selectpicker">
                {% for game in req.games %}
                <option value="{{game._id}}">{{game.name}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="tag" class="col-sm-2 control-label">By Tag</label>

        <div class="col-sm-8">
            <input type="text" name="allianceTag" placeholder="Tag" id="tag"
                   class="form-control">
        </div>
        <div class="col-sm-1">
            <button class="btn btn-primary" type="submit">Search</button>
        </div>
    </div>
</form>

<div class="col-sm-12" id="searchResult" hidden>
    <textarea id="RawJson" hidden></textarea>

    <div class="panel panel-default">
        <div class="panel-heading">
            <div hidden>
                <select id="TabSize" onchange="TabSizeChanged()">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
                <input type="checkbox" id="QuoteKeys" onclick="QuoteKeysClicked()"/>
                <input type="checkbox" id="CollapsibleView" onclick="CollapsibleViewClicked()" checked/>
            </div>
            <div id="CollapsibleViewDetail">
                <a href="javascript:void(0);" onclick="ExpandAllClicked()">展开</a>
                <a href="javascript:void(0);" onclick="CollapseAllClicked()">叠起</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(3)">2级</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(4)">3级</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(5)">4级</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(6)">5级</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(7)">6级</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(8)">7级</a>
                <a href="javascript:void(0);" onclick="CollapseLevel(9)">8级</a>
            </div>
        </div>
        <div class="panel-body" id="Canvas"></div>
    </div>
</div>

{% endblock %}

{% block foot %}
<script type="text/javascript">
    var beforeSubmit = function(){
        waitingDialog.show();
        return true;
    };

    var searchResult = $('#searchResult');
    $('#findById').ajaxForm({
        beforeSubmit:beforeSubmit,
        success:function(resp){
            waitingDialog.hide();
            if(resp.code === 500){
                new PNotify({
                    text:resp.data,
                    type:'error'
                });
            }else{
                new PNotify({
                    text:'Search successfully',
                    type:'success'
                });
                $('#RawJson').val(resp.data.allianceString);
                Process();
                CollapseLevel(3);
                searchResult.show();
            }
        }
    });

    $('#findByTag').ajaxForm({
        beforeSubmit:beforeSubmit,
        success:function(resp){
            waitingDialog.hide();
            if(resp.code === 500){
                new PNotify({
                    text:resp.data,
                    type:'error'
                });
            }else{
                new PNotify({
                    text:'Search successfully',
                    type:'success'
                });
                $('#RawJson').val(resp.data.allianceString);
                Process();
                CollapseLevel(3);
                searchResult.show();
            }
        }
    });
</script>
{% endblock %}